{% extends "base.html" %}

{% block title %}Profile{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">User Profile</h1>
</div>

<div class="row">
    <div class="col-md-8">
        <!-- Personal Information -->
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">Personal Information</h5>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('main.update_profile') }}" enctype="multipart/form-data">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="first_name" class="form-label">First Name <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="first_name" name="first_name" 
                                       value="{{ current_user.first_name }}" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="last_name" class="form-label">Last Name <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="last_name" name="last_name" 
                                       value="{{ current_user.last_name }}" required>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="email" class="form-label">Email <span class="text-danger">*</span></label>
                        <input type="email" class="form-control" id="email" name="email" 
                               value="{{ current_user.email }}" required>
                    </div>
                    
                    <!-- NEW: Contact Number Field -->
                    <div class="mb-3">
                        <label for="contact_number" class="form-label">Contact Number</label>
                        <input type="tel" class="form-control" id="contact_number" name="contact_number" 
                               value="{{ current_user.contact_number or '' }}" 
                               placeholder="+1234567890 or 0912-345-6789">
                        <small class="text-muted">Your contact number for emergency or work-related communications</small>
                    </div>
                    
                    <div class="mb-3">
                        <label for="avatar" class="form-label">Avatar</label>
                        <input type="file" class="form-control" id="avatar" name="avatar" accept="image/*">
                        <small class="text-muted">Upload a new avatar image (optional)</small>
                    </div>
                    
                    <!-- Digital Signature Upload -->
                    <div class="mb-3">
                        <label for="signature" class="form-label">Digital Signature</label>
                        <input type="file" class="form-control" id="signature" name="signature" accept="image/png">
                        <small class="text-muted">Upload your signature in PNG format (for PDF documents)</small>
                        {% if current_user.signature %}
                        <div class="mt-2">
                            <div class="alert alert-info d-flex align-items-center">
                                <i class="bi bi-check-circle me-2"></i>
                                <span>Current signature uploaded: {{ current_user.signature }}</span>
                                <button type="button" class="btn btn-sm btn-outline-secondary ms-auto" onclick="viewSignature()">
                                    <i class="bi bi-eye"></i> Preview
                                </button>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                    
                    <button type="submit" class="btn btn-primary">Update Personal Information</button>
                </form>
            </div>
        </div>

        <!-- Employment Information - READ ONLY -->
        <div class="card mt-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <h5 class="card-title mb-0">Employment Information</h5>
                <span class="badge bg-info">Read Only</span>
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <i class="bi bi-info-circle"></i>
                    <strong>Note:</strong> Employment information is managed by administrators and cannot be edited by users. 
                    Please contact your administrator if any information needs to be updated.
                </div>
                
                <!-- Basic Employment Details -->
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="personnel_number_readonly" class="form-label">Personnel Number</label>
                            <input type="text" class="form-control" id="personnel_number_readonly" 
                                   value="{{ current_user.personnel_number or 'Not set' }}" readonly>
                            <small class="text-muted">Unique employee identification number</small>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="div_department_readonly" class="form-label">Div./Department</label>
                            <input type="text" class="form-control" id="div_department_readonly" 
                                   value="{{ current_user.div_department or 'Not set' }}" readonly>
                            <small class="text-muted">Division or Department assignment</small>
                        </div>
                    </div>
                </div>
                
                <!-- Employee Type and Schedule Format -->
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="employee_type_readonly" class="form-label">Employee Type</label>
                            <input type="text" class="form-control" id="employee_type_readonly" 
                                   value="{% if current_user.employee_type %}{{ current_user.employee_type.value.replace('_', ' ').title() }}{% else %}Not set{% endif %}" readonly>
                            <small class="text-muted">Employee classification type</small>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="schedule_format_readonly" class="form-label">Regular Schedule Format</label>
                            <input type="text" class="form-control" id="schedule_format_readonly" 
                                   value="{% if current_user.schedule_format %}{% if current_user.schedule_format.value == '8_hour_shift' %}8-hour shift (30 min break){% elif current_user.schedule_format.value == '9_hour_shift' %}9-hour shift (1 hour break){% else %}Others{% endif %}{% else %}Not set{% endif %}" readonly>
                            <small class="text-muted">Default work schedule format for break calculations</small>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="id_number_readonly" class="form-label">ID Number</label>
                            <input type="text" class="form-control" id="id_number_readonly" 
                                   value="{{ current_user.id_number or 'Not set' }}" readonly>
                            <small class="text-muted">Government or company issued ID</small>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="hiring_date_readonly" class="form-label">Hiring Date</label>
                            <input type="text" class="form-control" id="hiring_date_readonly" 
                                   value="{% if current_user.hiring_date %}{{ current_user.hiring_date.strftime('%B %d, %Y') }}{% else %}Not set{% endif %}" readonly>
                            <small class="text-muted">Date when employment started</small>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="job_title_readonly" class="form-label">Job Title</label>
                            <input type="text" class="form-control" id="job_title_readonly" 
                                   value="{{ current_user.job_title or 'Not set' }}" readonly>
                            <small class="text-muted">Current position or job title</small>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="rank_readonly" class="form-label">Rank</label>
                            <input type="text" class="form-control" id="rank_readonly" 
                                   value="{{ current_user.rank or 'Not set' }}" readonly>
                            <small class="text-muted">Employee rank or level</small>
                        </div>
                    </div>
                </div>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="section_readonly" class="form-label">Section</label>
                            <input type="text" class="form-control" id="section_readonly" 
                                   value="{{ current_user.section.name if current_user.section else 'Not assigned' }}" readonly>
                            <small class="text-muted">Section assignment</small>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="mb-3">
                            <label for="unit_readonly" class="form-label">Unit</label>
                            <input type="text" class="form-control" id="unit_readonly" 
                                   value="{{ current_user.unit.name if current_user.unit else 'Not assigned' }}" readonly>
                            <small class="text-muted">Unit assignment</small>
                        </div>
                    </div>
                </div>
                
                <div class="alert alert-warning">
                    <i class="bi bi-exclamation-triangle"></i>
                    <strong>Need Changes?</strong> Contact your administrator to update employment information.
                </div>
            </div>
        </div>
    </div>
    
<!-- Update the Profile Summary section in profile.html -->

    <div class="col-md-4">
        <!-- Profile Summary -->
        <div class="card">
            <div class="card-body text-center">
                <div class="employee-initials mx-auto mb-3" style="width: 80px; height: 80px; font-size: 1.5rem;">
                    {{ current_user.initials }}
                </div>
                <h5 class="card-title">{{ current_user.full_name }}</h5>
                <p class="card-text text-muted">{{ current_user.role.value.title() }}</p>
                {% if current_user.job_title %}
                    <p class="card-text"><small class="text-primary">{{ current_user.job_title }}</small></p>
                {% endif %}
                
                <!-- 4-Level Hierarchy Display -->
                {% if current_user.department %}
                    <p class="card-text">
                        <small class="text-danger">
                            <i class="bi bi-building"></i> {{ current_user.department.name }}
                        </small>
                    </p>
                {% endif %}
                {% if current_user.division %}
                    <p class="card-text">
                        <small class="text-warning">
                            <i class="bi bi-diagram-2"></i> {{ current_user.division.name }}
                        </small>
                    </p>
                {% endif %}
                {% if current_user.section %}
                    <p class="card-text">
                        <small class="text-success">
                            <i class="bi bi-diagram-3"></i> {{ current_user.section.name }}
                        </small>
                    </p>
                {% endif %}
                {% if current_user.unit %}
                    <p class="card-text">
                        <small class="text-info">
                            <i class="bi bi-collection"></i> {{ current_user.unit.name }}
                        </small>
                    </p>
                {% endif %}
                
                {% if current_user.contact_number %}
                    <p class="card-text">
                        <small class="text-success">
                            <i class="bi bi-telephone"></i> {{ current_user.contact_number }}
                        </small>
                    </p>
                {% endif %}
                <p class="card-text"><small class="text-muted">Member since {{ current_user.created_at.strftime('%B %Y') }}</small></p>
            </div>
        </div>
        
        <!-- Employment Details -->
        <div class="card mt-3">
            <div class="card-header">
                <h6 class="card-title mb-0">Employment Details</h6>
            </div>
            <div class="card-body">
                <!-- 4-Level Hierarchy Summary -->
                <div class="row mb-2">
                    <div class="col-6">
                        <strong>Department:</strong>
                    </div>
                    <div class="col-6">
                        {% if current_user.department %}
                            <span class="badge bg-danger">{{ current_user.department.name }}</span>
                        {% else %}
                            <span class="text-muted">Not assigned</span>
                        {% endif %}
                    </div>
                </div>
                <div class="row mb-2">
                    <div class="col-6">
                        <strong>Division:</strong>
                    </div>
                    <div class="col-6">
                        {% if current_user.division %}
                            <span class="badge bg-warning text-dark">{{ current_user.division.name }}</span>
                        {% else %}
                            <span class="text-muted">Not assigned</span>
                        {% endif %}
                    </div>
                </div>
                <div class="row mb-2">
                    <div class="col-6">
                        <strong>Section:</strong>
                    </div>
                    <div class="col-6">
                        {% if current_user.section %}
                            <span class="badge bg-success">{{ current_user.section.name }}</span>
                        {% else %}
                            <span class="text-muted">Not assigned</span>
                        {% endif %}
                    </div>
                </div>
                <div class="row mb-2">
                    <div class="col-6">
                        <strong>Unit:</strong>
                    </div>
                    <div class="col-6">
                        {% if current_user.unit %}
                            <span class="badge bg-info">{{ current_user.unit.name }}</span>
                        {% else %}
                            <span class="text-muted">Not assigned</span>
                        {% endif %}
                    </div>
                </div>
                
                <hr>
                
                <div class="row mb-2">
                    <div class="col-6">
                        <strong>Personnel #:</strong>
                    </div>
                    <div class="col-6">
                        {{ current_user.personnel_number or 'Not set' }}
                    </div>
                </div>
                <div class="row mb-2">
                    <div class="col-6">
                        <strong>Contact:</strong>
                    </div>
                    <div class="col-6">
                        {% if current_user.contact_number %}
                            <span class="badge bg-success">
                                <i class="bi bi-telephone"></i> Provided
                            </span>
                        {% else %}
                            <span class="badge bg-warning text-dark">
                                <i class="bi bi-telephone-x"></i> Not provided
                            </span>
                        {% endif %}
                    </div>
                </div>
                <div class="row mb-2">
                    <div class="col-6">
                        <strong>Employee Type:</strong>
                    </div>
                    <div class="col-6">
                        {% if current_user.employee_type %}
                            <span class="badge bg-{{ 'warning' if current_user.employee_type.value == 'confidential' else 'info' if current_user.employee_type.value == 'contractual' else 'primary' }}">
                                {{ current_user.employee_type.value.replace('_', ' ').title() }}
                            </span>
                        {% else %}
                            Not set
                        {% endif %}
                    </div>
                </div>
                <div class="row mb-2">
                    <div class="col-6">
                        <strong>Schedule Format:</strong>
                    </div>
                    <div class="col-6">
                        {% if current_user.schedule_format %}
                            <span class="badge bg-{{ 'success' if current_user.schedule_format.value == '8_hour_shift' else 'warning' if current_user.schedule_format.value == '9_hour_shift' else 'secondary' }}">
                                {% if current_user.schedule_format.value == '8_hour_shift' %}
                                    8-hour (30min break)
                                {% elif current_user.schedule_format.value == '9_hour_shift' %}
                                    9-hour (1hr break)
                                {% else %}
                                    Others
                                {% endif %}
                            </span>
                        {% else %}
                            Not set
                        {% endif %}
                    </div>
                </div>
                <div class="row mb-2">
                    <div class="col-6">
                        <strong>ID Number:</strong>
                    </div>
                    <div class="col-6">
                        {% if current_user.id_number %}
                            <span class="font-monospace">{{ current_user.id_number[:4] }}***</span>
                        {% else %}
                            Not set
                        {% endif %}
                    </div>
                </div>
                <div class="row mb-2">
                    <div class="col-6">
                        <strong>Hired:</strong>
                    </div>
                    <div class="col-6">
                        {% if current_user.hiring_date %}
                            {{ current_user.hiring_date.strftime('%b %d, %Y') }}
                        {% else %}
                            Not set
                        {% endif %}
                    </div>
                </div>
                {% if current_user.years_of_service %}
                <div class="row mb-2">
                    <div class="col-6">
                        <strong>Service:</strong>
                    </div>
                    <div class="col-6">
                        <span class="badge bg-success">{{ current_user.years_of_service }} years</span>
                    </div>
                </div>
                {% endif %}
                <div class="row mb-2">
                    <div class="col-6">
                        <strong>Rank:</strong>
                    </div>
                    <div class="col-6">
                        {% if current_user.rank %}
                            <span class="badge bg-info">{{ current_user.rank }}</span>
                        {% else %}
                            Not set
                        {% endif %}
                    </div>
                </div>
                <div class="row mb-2">
                    <div class="col-6">
                        <strong>Signature:</strong>
                    </div>
                    <div class="col-6">
                        {% if current_user.signature %}
                            <span class="badge bg-success">
                                <i class="bi bi-check-circle"></i> Uploaded
                            </span>
                        {% else %}
                            <span class="badge bg-secondary">Not uploaded</span>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Approver Status Card -->
        <div class="card mt-3">
            <div class="card-header">
                <h6 class="card-title mb-0">Approval Authority</h6>
            </div>
            <div class="card-body">
                {% if current_user.can_approve_leaves() %}
                    <div class="alert alert-success p-2">
                        <i class="bi bi-check-circle"></i> <strong>Can Approve Leaves</strong>
                    </div>
                    
                    <div class="d-flex flex-wrap gap-1 mb-2">
                        {% if current_user.is_department_approver %}
                            <span class="badge bg-danger">Dept</span>
                        {% endif %}
                        {% if current_user.is_division_approver %}
                            <span class="badge bg-warning">Div</span>
                        {% endif %}
                        {% if current_user.is_section_approver %}
                            <span class="badge bg-success">Sec</span>
                        {% endif %}
                        {% if current_user.is_unit_approver %}
                            <span class="badge bg-info">Unit</span>
                        {% endif %}
                        {% if current_user.role.value in ['manager', 'administrator'] %}
                            <span class="badge bg-primary">{{ current_user.role.value.title() }}</span>
                        {% endif %}
                    </div>
                    
                    <small class="text-muted">
                        <strong>Scope:</strong> {{ current_user.approver_scope }}
                    </small>
                {% else %}
                    <div class="alert alert-light p-2">
                        <i class="bi bi-info-circle"></i> No approval authority assigned
                    </div>
                {% endif %}
            </div>
        </div>
        
        <!-- Account Details -->
        <div class="card mt-3">
            <div class="card-header">
                <h6 class="card-title mb-0">Account Details</h6>
            </div>
            <div class="card-body">
                <div class="row mb-2">
                    <div class="col-6">
                        <strong>Username:</strong>
                    </div>
                    <div class="col-6">
                        {{ current_user.username }}
                    </div>
                </div>
                <div class="row mb-2">
                    <div class="col-6">
                        <strong>Status:</strong>
                    </div>
                    <div class="col-6">
                        <span class="badge bg-{{ 'success' if current_user.is_active else 'danger' }}">
                            {{ 'Active' if current_user.is_active else 'Inactive' }}
                        </span>
                    </div>
                </div>
                <div class="row mb-2">
                    <div class="col-6">
                        <strong>Last Updated:</strong>
                    </div>
                    <div class="col-6">
                        <small class="text-muted">{{ current_user.updated_at.strftime('%b %d, %Y') }}</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="card mt-3">
            <div class="card-header">
                <h6 class="card-title mb-0">Quick Actions</h6>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a href="{{ url_for('schedule.view_schedule') }}" class="btn btn-outline-primary btn-sm">
                        <i class="bi bi-calendar3"></i> View My Schedule
                    </a>
                    <button class="btn btn-outline-secondary btn-sm" onclick="changePassword()">
                        <i class="bi bi-key"></i> Change Password
                    </button>
                    <button class="btn btn-outline-info btn-sm" onclick="downloadProfile()">
                        <i class="bi bi-download"></i> Download Profile
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- Change Password Modal -->
<div class="modal fade" id="changePasswordModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Change Password</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form method="POST" action="{{ url_for('main.change_password') }}">
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="current_password" class="form-label">Current Password</label>
                        <input type="password" class="form-control" id="current_password" name="current_password" required>
                    </div>
                    <div class="mb-3">
                        <label for="new_password" class="form-label">New Password</label>
                        <input type="password" class="form-control" id="new_password" name="new_password" required>
                        <small class="text-muted">Minimum 6 characters</small>
                    </div>
                    <div class="mb-3">
                        <label for="confirm_password" class="form-label">Confirm New Password</label>
                        <input type="password" class="form-control" id="confirm_password" name="confirm_password" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Change Password</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Signature Preview Modal -->
<div class="modal fade" id="signatureModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Digital Signature Preview</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body text-center">
                {% if current_user.signature %}
                    <img src="{{ url_for('main.uploaded_signature', filename=current_user.signature) }}" 
                         alt="Digital Signature" class="img-fluid border" style="max-height: 200px;">
                    <p class="mt-2 text-muted">Signature file: {{ current_user.signature }}</p>
                {% else %}
                    <p>No signature uploaded yet.</p>
                {% endif %}
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function changePassword() {
    new bootstrap.Modal(document.getElementById('changePasswordModal')).show();
}

function viewSignature() {
    new bootstrap.Modal(document.getElementById('signatureModal')).show();
}

function downloadProfile() {
    // Generate a comprehensive profile summary
    const profileData = {
        name: '{{ current_user.full_name }}',
        username: '{{ current_user.username }}',
        email: '{{ current_user.email }}',
        role: '{{ current_user.role.value.title() }}',
        contact_number: '{{ current_user.contact_number or "" }}',
        personnel_number: '{{ current_user.personnel_number or "" }}',
        div_department: '{{ current_user.div_department or "" }}',
        employee_type: '{{ current_user.employee_type.value.replace("_", " ").title() if current_user.employee_type else "" }}',
        schedule_format: '{{ current_user.schedule_format.value.replace("_", " ").title() if current_user.schedule_format else "" }}',
        typecode: '{{ current_user.typecode or "" }}',
        job_title: '{{ current_user.job_title or "" }}',
        rank: '{{ current_user.rank or "" }}',
        hiring_date: '{{ current_user.hiring_date.strftime("%Y-%m-%d") if current_user.hiring_date else "" }}',
        section: '{{ current_user.section.name if current_user.section else "" }}',
        unit: '{{ current_user.unit.name if current_user.unit else "" }}',
        signature_status: '{{ "Uploaded" if current_user.signature else "Not uploaded" }}'
    };
    
    const content = `Employee Profile Summary
=========================

Personal Information:
- Name: ${profileData.name}
- Username: ${profileData.username}
- Email: ${profileData.email}
- Contact Number: ${profileData.contact_number || 'Not provided'}

Employment Information:
- Role: ${profileData.role}
- Div./Department: ${profileData.div_department || 'Not set'}
- Employee Type: ${profileData.employee_type || 'Not set'}
- Schedule Format: ${profileData.schedule_format || 'Not set'}
- Personnel Number: ${profileData.personnel_number || 'Not set'}
- Job Title: ${profileData.job_title || 'Not set'}
- Rank: ${profileData.rank || 'Not set'}
- Hiring Date: ${profileData.hiring_date || 'Not set'}
- Section: ${profileData.section || 'Not assigned'}
- Unit: ${profileData.unit || 'Not assigned'}
- Digital Signature: ${profileData.signature_status}

Generated on: ${new Date().toLocaleString()}
`;
    
    const blob = new Blob([content], { type: 'text/plain' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `${profileData.username}_profile.txt`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    window.URL.revokeObjectURL(url);
}

// Contact number validation
document.getElementById('contact_number')?.addEventListener('input', function() {
    const contactNumber = this.value.trim();
    
    if (contactNumber.length > 0) {
        // Basic phone number validation (allows various formats)
        const phoneRegex = /^[\+]?[\s\-\(\)]*([0-9][\s\-\(\)]*){10,15}$/;
        if (phoneRegex.test(contactNumber)) {
            this.classList.remove('is-invalid');
            this.classList.add('is-valid');
        } else {
            this.classList.remove('is-valid');
            this.classList.add('is-invalid');
        }
    } else {
        this.classList.remove('is-valid', 'is-invalid');
    }
});

// Password validation
document.getElementById('new_password')?.addEventListener('input', function() {
    const password = this.value;
    
    if (password.length > 0) {
        if (password.length >= 6) {
            this.classList.remove('is-invalid');
            this.classList.add('is-valid');
        } else {
            this.classList.remove('is-valid');
            this.classList.add('is-invalid');
        }
    } else {
        this.classList.remove('is-valid', 'is-invalid');
    }
});

// Confirm password validation
document.getElementById('confirm_password')?.addEventListener('input', function() {
    const newPassword = document.getElementById('new_password').value;
    const confirmPassword = this.value;
    
    if (confirmPassword.length > 0) {
        if (confirmPassword === newPassword) {
            this.classList.remove('is-invalid');
            this.classList.add('is-valid');
        } else {
            this.classList.remove('is-valid');
            this.classList.add('is-invalid');
        }
    } else {
        this.classList.remove('is-valid', 'is-invalid');
    }
});

// Signature file validation
document.getElementById('signature')?.addEventListener('change', function() {
    const file = this.files[0];
    if (file) {
        // Check file type
        if (file.type !== 'image/png') {
            this.classList.add('is-invalid');
            this.setCustomValidity('Please upload a PNG file only');
            alert('Please upload a PNG file only.');
            this.value = '';
        } else if (file.size > 2 * 1024 * 1024) { // 2MB limit
            this.classList.add('is-invalid');
            this.setCustomValidity('File size should be less than 2MB');
            alert('File size should be less than 2MB.');
            this.value = '';
        } else {
            this.classList.remove('is-invalid');
            this.classList.add('is-valid');
            this.setCustomValidity('');
        }
    }
});
</script>
{% endblock %}